import re

from cve_bin_tool.parsers import Parser


class CCppParser(Parser):
    """Parser for C/C++ conan.lock files"""

    PARSER_MATCH_FILENAMES = [
        "package-lock.json",
    ]

    def __init__(self, cve_db, logger):
        super().__init__(cve_db, logger)
        self.purl_pkg_type = "npm"

    def generate_purl(self, product, vendor="", qualifier={}, subpath=None):
        """Generates PURL after normalizing all components."""
        product = re.sub(r"[^a-zA-Z0-9._-]", "", product).lower()

        if not product:
            return None

        purl = super().generate_purl(
            product,
            vendor,
            qualifier,
            subpath,
        )

        return purl
